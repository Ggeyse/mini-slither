<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mini Slither with Shop</title>
  <style>
    html, body { height: 100%; }
    body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; }
    canvas { display: block; background: #222; }

    /* Shop overlay */
    #shop {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      color: white;
      padding: 40px;
    }
    #shop h1 { margin-top: 0; }
    .skin {
      display: inline-block;
      margin: 20px;
      padding: 20px;
      border: 2px solid white;
      cursor: pointer;
      border-radius: 10px;
    }
    .owned { border-color: gold; }
    .selected { background: rgba(255,255,255,0.2); }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <div id="shop">
    <h1>Snake Shop</h1>
    <p>Press <b>S</b> to close shop</p>
    <div id="skins"></div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const shopEl = document.getElementById("shop");
    const skinsEl = document.getElementById("skins");

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    // --- Game state ---
    let snake = [{ x: 200, y: 200 }];
    let food = { x: 300, y: 300 };
    let length = 5;
    let angle = 0;
    let speed = 2.25;
    let mouse = { x: 200, y: 200 };

    // HUD
    let apples = 0;
    let startTime = Date.now();

    // Shop/skins
    const availableSkins = [
      { name: "Lime", color: "lime", cost: 0 },
      { name: "Blue", color: "deepskyblue", cost: 5 },
      { name: "Gold", color: "gold", cost: 10 },
      { name: "Rainbow", color: "rainbow", cost: 20 }
    ];
    let ownedSkins = JSON.parse(localStorage.getItem("ownedSkins")) || ["Lime"];
    let selectedSkin = localStorage.getItem("selectedSkin") || "Lime";

    document.addEventListener("mousemove", (e) => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });

    document.addEventListener("keydown", (e) => {
      if (e.key.toLowerCase() === "s") {
        shopEl.style.display = (shopEl.style.display === "none") ? "block" : "none";
        renderShop();
      }
    });

    function drawBackground() {
      const g = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      g.addColorStop(0, "#0f0f0f");
      g.addColorStop(1, "#2b2b2b");
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.lineWidth = 1;
      ctx.strokeStyle = "rgba(255,255,255,0.06)";
      for (let x = 0; x < canvas.width; x += 50) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += 50) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
      }
    }

    function drawSnake(color) {
      if (color === "rainbow") {
        for (let i = 0; i < snake.length; i++) {
          const hue = (i * 10 + Date.now() / 20) % 360;
          ctx.fillStyle = "hsl(" + hue + ",100%,50%)";
          ctx.beginPath();
          ctx.arc(snake[i].x, snake[i].y, 8, 0, Math.PI * 2);
          ctx.fill();
        }
      } else {
        ctx.fillStyle = color;
        for (let i = 0; i < snake.length; i++) {
          ctx.beginPath();
          ctx.arc(snake[i].x, snake[i].y, 8, 0, Math.PI * 2);
          ctx.fill();
        }
      }
      // Eyes
      const head = snake[0];
      const eyeDist = 6, eyeR = 3, pupilR = 1.5;
      const ex1 = head.x + Math.cos(angle + Math.PI / 4) * eyeDist;
      const ey1 = head.y + Math.sin(angle + Math.PI / 4) * eyeDist;
      const ex2 = head.x + Math.cos(angle - Math.PI / 4) * eyeDist;
      const ey2 = head.y + Math.sin(angle - Math.PI / 4) * eyeDist;
      ctx.fillStyle = "white";
      ctx.beginPath(); ctx.arc(ex1, ey1, eyeR, 0, Math.PI * 2); ctx.arc(ex2, ey2, eyeR, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = "black";
      ctx.beginPath(); ctx.arc(ex1, ey1, pupilR, 0, Math.PI * 2); ctx.arc(ex2, ey2, pupilR, 0, Math.PI * 2); ctx.fill();
    }

    function spawnFood() {
      food = {
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
      };
    }

    function gameLoop() {
      drawBackground();

      // movement
      const dx = mouse.x - snake[0].x;
      const dy = mouse.y - snake[0].y;
      angle = Math.atan2(dy, dx);

      const newHead = {
        x: snake[0].x + Math.cos(angle) * speed,
        y: snake[0].y + Math.sin(angle) * speed,
      };
      snake.unshift(newHead);
      if (snake.length > length) snake.pop();

      // draw snake with current skin
      const skin = selectedSkin.toLowerCase();
      drawSnake(skin);

      // draw food
      ctx.fillStyle = "red";
      ctx.beginPath();
      ctx.arc(food.x, food.y, 10, 0, Math.PI * 2);
      ctx.fill();

      // eat food
      const dist = Math.hypot(snake[0].x - food.x, snake[0].y - food.y);
      if (dist < 15) {
        length += 5;
        apples++;
        spawnFood();
      }

      // HUD
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText("Apples: " + apples, 20, 30);
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      ctx.fillText("Time: " + elapsed + "s", 20, 60);

      requestAnimationFrame(gameLoop);
    }

    function renderShop() {
      skinsEl.innerHTML = "";
      availableSkins.forEach(skin => {
        const div = document.createElement("div");
        div.className = "skin";
        if (ownedSkins.includes(skin.name)) div.classList.add("owned");
        if (selectedSkin === skin.name) div.classList.add("selected");
        div.textContent = skin.name + " (" + skin.cost + " apples)";
        div.onclick = () => {
          if (!ownedSkins.includes(skin.name)) {
            if (apples >= skin.cost) {
              apples -= skin.cost;
              ownedSkins.push(skin.name);
              localStorage.setItem("ownedSkins", JSON.stringify(ownedSkins));
            } else {
              alert("Not enough apples!");
              return;
            }
          }
          selectedSkin = skin.name;
          localStorage.setItem("selectedSkin", selectedSkin);
          renderShop();
        };
        skinsEl.appendChild(div);
      });
    }

    spawnFood();
    gameLoop();
  </script>
</body>
</html>
